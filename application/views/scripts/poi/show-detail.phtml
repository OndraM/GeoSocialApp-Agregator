<div id="detail">
<h1><?=$this->pois[0]->name;?></h1>
<div id="detail-map"></div>
<strong id="venue-source">Sources of venue data:</strong>
<?php
echo "<ul>\n";
foreach ($this->pois as $poi) {
    echo "\t<li><a href=\""
        . $this->escape($poi->url)
        . "\" target=\"_blank\" class=\"external\""
        . "title=\"Open venue detail on "
        . $this->services[$poi->type]['name']
        . " (opens in new window)\""
        . ">"
        . $this->serviceIcon($poi->type)
        . $this->escape($poi->name)
        . "</a></li>\n";
}
echo "</ul>\n";
?>
<h2>Contact</h2>
<?php
$address = $this->listPoisField($this->pois, 'address');
if (!empty($address)) {
    echo "<h3 id=\"venue-address\">Address</h3>\n";
    echo $address;
}
?>
<?php
$phone = $this->listPoisField($this->pois, 'phone');
if (!empty($phone)) {
    echo "<h3 id=\"venue-phone\">Phone</h3>\n";
    echo $phone;
}
?>
<?php
$links = $this->listPoisField($this->pois, 'links');
if (!empty($links)) {
    echo "<h3 id=\"venue-links\">Links</h3>\n";
    echo $links;
}
/*
?>
<h2 id=\"venue-photos\">Photos</h2>
<p>TODO</p>
<?php
 * 
 */
$tips = $this->listPoisField($this->pois, 'tips');
if (!empty($tips)) {
    echo "<h2 id=\"venue-tips\">Tips</h2>\n";
    echo $tips;
}
?>
</div>
<?php
$script = "var markers = [];";
foreach ($this->pois as $poi) {
    $script .= "markers.push([new google.maps.LatLng(" . $poi->lat . ", " . $poi->lng . "), 'Venue location by " . $this->services[$poi->type]['name'] . "']);";
}

$script .= "
    var latlng = new google.maps.LatLng(" . $this->pois[0]->lat . "," . $this->pois[0]->lng . ");
    
    var mapOptions = {
        zoom: 16,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
        // TODO: hide some control elements?
    };
    var map = new google.maps.Map(
        document.getElementById('detail-map'),
        mapOptions
    );    
    
    var bounds = new google.maps.LatLngBounds ();
    $.each(markers, function(i, marker) {    
        new google.maps.Marker({
            position: marker[0],
            map: map,
            title: marker[1]
        });
      bounds.extend(marker[0]);
    });
    map.fitBounds(bounds);
    // limit maximum zoom after fit bounds 
    if (map.getZoom() > 17) {
        map.setZoom(17);
    }
    
    var allTips = $('#venue-tips').next('ul').children();
    var tipsLimit = 10;
    if (allTips.length > tipsLimit) {
        var hideTips = allTips.slice(tipsLimit);
        hideTips.hide();
        $('<li><a href=\"#\">Only ' + tipsLimit + ' first tips are shown. Click here to show remaining ' + hideTips.length + '.</a></li>')
            .appendTo($('#venue-tips').next('ul'))
            .click(function() {
                hideTips.show();
                $(this).remove();
            });
    }
    

    ";
echo $this->script($script, true);
?>
