/**
 * MarkerWithLabel for V3
 * Author: Gary Little (inspired by code from Marc Ridey of Google),
 *         modified by http://www.4sqmap.com/.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function MarkerLabel_(a,c){this.marker_=a;this.handCursorURL_=a.handCursorURL;this.labelDiv_=document.createElement("div");this.labelDiv_.style.cssText="position: absolute; overflow: hidden;";this.eventDiv_=document.createElement("div");this.eventDiv_.style.cssText=this.labelDiv_.style.cssText;this.eventDiv_.setAttribute("onselectstart","return false;");this.eventDiv_.setAttribute("ondragstart","return false;");this.crossDiv_=MarkerLabel_.getSharedCross(c)}MarkerLabel_.prototype=new google.maps.OverlayView;
MarkerLabel_.getSharedCross=function(a){var c;if(typeof MarkerLabel_.getSharedCross.crossDiv==="undefined")c=document.createElement("img"),c.style.cssText="position: absolute; z-index: 1000002; display: none;",c.style.marginLeft="-8px",c.style.marginTop="-9px",c.src=a,MarkerLabel_.getSharedCross.crossDiv=c;return MarkerLabel_.getSharedCross.crossDiv};
MarkerLabel_.prototype.onAdd=function(){var a=this,c=!1,d=!1,i,j,k,h,f,l,m,n="url("+this.handCursorURL_+")",g=function(a){a.preventDefault&&a.preventDefault();a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()},o=function(){a.marker_.setAnimation(null)};this.getPanes().overlayImage.appendChild(this.labelDiv_);this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_);if(typeof MarkerLabel_.getSharedCross.processed==="undefined")this.getPanes().overlayImage.appendChild(this.crossDiv_),MarkerLabel_.getSharedCross.processed=
!0;this.listeners_=[google.maps.event.addDomListener(this.eventDiv_,"mouseover",function(b){if(a.marker_.getDraggable()||a.marker_.getClickable())this.style.cursor="pointer",google.maps.event.trigger(a.marker_,"mouseover",b)}),google.maps.event.addDomListener(this.eventDiv_,"mouseout",function(b){if((a.marker_.getDraggable()||a.marker_.getClickable())&&!d)this.style.cursor=a.marker_.getCursor(),google.maps.event.trigger(a.marker_,"mouseout",b)}),google.maps.event.addDomListener(this.eventDiv_,"mousedown",
function(b){d=!1;if(a.marker_.getDraggable())c=!0,this.style.cursor=n;if(a.marker_.getDraggable()||a.marker_.getClickable())google.maps.event.trigger(a.marker_,"mousedown",b),g(b)}),google.maps.event.addDomListener(document,"mouseup",function(b){var e;if(c)c=!1,a.eventDiv_.style.cursor="pointer",google.maps.event.trigger(a.marker_,"mouseup",b);if(d){if(f){e=a.getProjection().fromLatLngToDivPixel(a.marker_.getPosition());e.y+=20;a.marker_.setPosition(a.getProjection().fromDivPixelToLatLng(e));try{a.marker_.setAnimation(google.maps.Animation.BOUNCE),
setTimeout(o,1406)}catch(g){}}a.crossDiv_.style.display="none";a.marker_.setZIndex(i);h=!0;d=!1;b.latLng=a.marker_.getPosition();google.maps.event.trigger(a.marker_,"dragend",b)}}),google.maps.event.addListener(a.marker_.getMap(),"mousemove",function(b){var e;if(c)if(d){b.latLng=new google.maps.LatLng(b.latLng.lat()-j,b.latLng.lng()-k);e=a.getProjection().fromLatLngToDivPixel(b.latLng);if(f)a.crossDiv_.style.left=e.x+"px",a.crossDiv_.style.top=e.y+"px",a.crossDiv_.style.display="",e.y-=20;a.marker_.setPosition(a.getProjection().fromDivPixelToLatLng(e));
if(f)a.eventDiv_.style.top=e.y+20+"px";google.maps.event.trigger(a.marker_,"drag",b)}else j=b.latLng.lat()-a.marker_.getPosition().lat(),k=b.latLng.lng()-a.marker_.getPosition().lng(),i=a.marker_.getZIndex(),l=a.marker_.getPosition(),m=a.marker_.getMap().getCenter(),f=a.marker_.get("raiseOnDrag"),d=!0,a.marker_.setZIndex(1E6),b.latLng=a.marker_.getPosition(),google.maps.event.trigger(a.marker_,"dragstart",b)}),google.maps.event.addDomListener(document,"keydown",function(b){d&&b.keyCode===27&&(f=!1,
a.marker_.setPosition(l),a.marker_.getMap().setCenter(m),google.maps.event.trigger(document,"mouseup",b))}),google.maps.event.addDomListener(this.eventDiv_,"click",function(b){if(a.marker_.getDraggable()||a.marker_.getClickable())h?h=!1:(google.maps.event.trigger(a.marker_,"click",b),g(b))}),google.maps.event.addDomListener(this.eventDiv_,"dblclick",function(b){if(a.marker_.getDraggable()||a.marker_.getClickable())google.maps.event.trigger(a.marker_,"dblclick",b),g(b)}),google.maps.event.addListener(this.marker_,
"dragstart",function(){d||(f=this.get("raiseOnDrag"))}),google.maps.event.addListener(this.marker_,"drag",function(){if(!d&&f)a.setPosition(20),a.labelDiv_.style.zIndex=1E6+(this.get("labelInBackground")?-1:1)}),google.maps.event.addListener(this.marker_,"dragend",function(){d||f&&a.setPosition(0)}),google.maps.event.addListener(this.marker_,"position_changed",function(){a.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){a.setZIndex()}),google.maps.event.addListener(this.marker_,
"visible_changed",function(){a.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){a.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){a.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){a.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){a.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){a.setStyles()}),
google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){a.setStyles()})]};MarkerLabel_.prototype.onRemove=function(){var a;this.labelDiv_.parentNode.removeChild(this.labelDiv_);this.eventDiv_.parentNode.removeChild(this.eventDiv_);for(a=0;a<this.listeners_.length;a++)google.maps.event.removeListener(this.listeners_[a])};MarkerLabel_.prototype.draw=function(){this.setContent();this.setTitle();this.setStyles()};
MarkerLabel_.prototype.setContent=function(){var a=this.marker_.get("labelContent");typeof a.nodeType==="undefined"?(this.labelDiv_.innerHTML=a,this.eventDiv_.innerHTML=this.labelDiv_.innerHTML):(this.labelDiv_.innerHTML="",this.labelDiv_.appendChild(a),a=a.cloneNode(!0),this.eventDiv_.innerHTML="",this.eventDiv_.appendChild(a))};MarkerLabel_.prototype.setTitle=function(){this.eventDiv_.title=this.marker_.getTitle()||""};
MarkerLabel_.prototype.setStyles=function(){var a,c;this.labelDiv_.className=this.marker_.get("labelClass");this.eventDiv_.className=this.labelDiv_.className;this.labelDiv_.style.cssText="";this.eventDiv_.style.cssText="";c=this.marker_.get("labelStyle");for(a in c)c.hasOwnProperty(a)&&(this.labelDiv_.style[a]=c[a],this.eventDiv_.style[a]=c[a]);this.setMandatoryStyles()};
MarkerLabel_.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute";this.labelDiv_.style.overflow="hidden";if(typeof this.labelDiv_.style.opacity!=="undefined"&&this.labelDiv_.style.opacity!=="")this.labelDiv_.style.filter="alpha(opacity="+this.labelDiv_.style.opacity*100+")";this.eventDiv_.style.position=this.labelDiv_.style.position;this.eventDiv_.style.overflow=this.labelDiv_.style.overflow;this.eventDiv_.style.opacity=0.01;this.eventDiv_.style.filter="alpha(opacity=1)";
this.setAnchor();this.setPosition();this.setVisible()};MarkerLabel_.prototype.setAnchor=function(){var a=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-a.x+"px";this.labelDiv_.style.marginTop=-a.y+"px";this.eventDiv_.style.marginLeft=-a.x+"px";this.eventDiv_.style.marginTop=-a.y+"px"};
MarkerLabel_.prototype.setPosition=function(a){var c=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());typeof a==="undefined"&&(a=0);this.labelDiv_.style.left=Math.round(c.x)+"px";this.labelDiv_.style.top=Math.round(c.y-a)+"px";this.eventDiv_.style.left=this.labelDiv_.style.left;this.eventDiv_.style.top=this.labelDiv_.style.top;this.setZIndex()};
MarkerLabel_.prototype.setZIndex=function(){var a=this.marker_.get("labelInBackground")?-1:1;this.labelDiv_.style.zIndex=typeof this.marker_.getZIndex()==="undefined"?parseInt(this.labelDiv_.style.top,10)+a:this.marker_.getZIndex()+a;this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex};MarkerLabel_.prototype.setVisible=function(){this.labelDiv_.style.display=this.marker_.get("labelVisible")?this.marker_.getVisible()?"block":"none":"none";this.eventDiv_.style.display=this.labelDiv_.style.display};
function MarkerWithLabel(a){a=a||{};a.labelContent=a.labelContent||"";a.labelAnchor=a.labelAnchor||new google.maps.Point(0,0);a.labelClass=a.labelClass||"markerLabels";a.labelStyle=a.labelStyle||{};a.labelInBackground=a.labelInBackground||!1;if(typeof a.labelVisible==="undefined")a.labelVisible=!0;if(typeof a.raiseOnDrag==="undefined")a.raiseOnDrag=!0;if(typeof a.clickable==="undefined")a.clickable=!0;if(typeof a.draggable==="undefined")a.draggable=!1;if(typeof a.optimized==="undefined")a.optimized=
!1;a.crossImage=a.crossImage||"http://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png";a.handCursor=a.handCursor||"http://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur";a.optimized=!1;this.label=new MarkerLabel_(this,a.crossImage,a.handCursor);google.maps.Marker.apply(this,arguments)}MarkerWithLabel.prototype=new google.maps.Marker;MarkerWithLabel.prototype.setMap=function(a){google.maps.Marker.prototype.setMap.apply(this,arguments);this.label.setMap(a)};
